import numpy as np
import matplotlib.pyplot as plt
from scipy.spatial.distance import cdist

# === 1. Load data ===
raw_data = """
1.2562814070351758, 8.944099378881987
1.3819095477386933, 8.944099378881987
1.482412060301507, 8.944099378881987
1.608040201005025, 8.944099378881987
1.658291457286432, 9.19254658385093
1.8844221105527637, 9.254658385093167
1.9346733668341707, 9.006211180124222
1.9095477386934672, 8.633540372670806
1.8341708542713566, 8.4472049689441
1.8341708542713566, 8.136645962732917
1.8341708542713566, 7.826086956521738
1.8592964824120597, 7.453416149068323
1.9095477386934672, 7.0807453416149055
1.9346733668341707, 6.708074534161488
1.9095477386934672, 6.459627329192546
1.9346733668341707, 6.024844720496894
1.9849246231155777, 5.776397515527947
1.9849246231155777, 5.403726708074533
1.9849246231155777, 5.155279503105589
2.236180904522613, 5.217391304347824
2.28643216080402, 5.527950310559007
2.336683417085427, 5.90062111801242
2.4120603015075375, 6.086956521739129
2.5376884422110546, 6.273291925465838
2.6884422110552757, 6.397515527950308
2.7889447236180906, 6.459627329192546
2.914572864321608, 6.521739130434781
3.040201005025125, 6.521739130434781
3.165829145728643, 6.583850931677018
3.241206030150753, 6.521739130434781
3.366834170854271, 6.521739130434781
3.467336683417085, 6.521739130434781
3.567839195979899, 6.583850931677018
3.693467336683417, 6.583850931677018
3.7939698492462304, 6.645962732919253
3.9447236180904524, 6.645962732919253
4.0452261306532655, 6.645962732919253
4.1708542713567835, 6.459627329192546
4.271356783919598, 6.149068322981364
4.296482412060302, 5.838509316770185
4.296482412060302, 5.590062111801242
4.346733668341708, 5.155279503105589
4.296482412060302, 4.720496894409937
4.221105527638191, 4.34782608695652
4.0703517587939695, 4.0372670807453375
4.0452261306532655, 3.8509316770186324
4.1708542713567835, 3.7888198757763973
3.8693467336683414, 3.8509316770186324
3.693467336683417, 3.7888198757763973
3.517587939698492, 3.7267080745341588
3.366834170854271, 3.7267080745341588
3.241206030150753, 3.7888198757763973
3.065326633165829, 3.7888198757763973
2.914572864321608, 3.9130434782608674
2.7638190954773867, 3.9751552795031024
2.5879396984924625, 3.9751552795031024
2.437185929648241, 4.0372670807453375
2.336683417085427, 4.161490683229811
2.28643216080402, 4.47204968944099
1.9597989949748742, 4.47204968944099
1.9849246231155777, 4.658385093167702
2.0100502512562812, 4.844720496894407
2.236180904522613, 4.844720496894407
1.9095477386934672, 4.285714285714285
1.8844221105527637, 3.9751552795031024
1.8844221105527637, 3.602484472049685
1.8844221105527637, 3.41614906832298
1.8592964824120597, 3.1055900621117978
1.8341708542713566, 2.670807453416149
1.8341708542713566, 2.236024844720493
1.8592964824120597, 1.8633540372670794
1.9095477386934672, 1.490683229813662
1.9346733668341707, 1.1801242236024834
1.8844221105527637, 1.1180124223602448
1.809045226130653, 1.1180124223602448
1.6834170854271355, 1.1801242236024834
1.6331658291457285, 1.3043478260869534
1.557788944723618, 1.4285714285714235
1.482412060301507, 1.6149068322981357
1.4321608040201004, 1.7391304347826093
1.4070351758793969, 1.9875776397515494
1.3819095477386933, 2.049689440993788
1.3567839195979898, 2.236024844720493
1.3065326633165828, 2.484472049689437
1.3065326633165828, 2.670807453416149
1.0804020100502512, 2.795031055900619
1.1055276381909547, 2.9813664596273277
1.2562814070351758, 2.9813664596273277
1.2060301507537687, 3.2298136645962714
1.1306532663316582, 3.2298136645962714
1.1306532663316582, 3.602484472049685
0.3517587939698492, 3.8509316770186324
0.3015075376884422, 3.602484472049685
0.3015075376884422, 3.41614906832298
0.27638190954773867, 3.0434782608695627
0.22613065326633164, 2.732919254658384
0.2010050251256279, 2.4223602484472018
0.22613065326633164, 2.173913043478258
0.25125628140703515, 1.9254658385093144
0.1758793969849246, 1.6149068322981357
0.4773869346733668, 1.6770186335403707
0.6030150753768844, 1.7391304347826093
0.7035175879396984, 1.6770186335403707
0.8542713567839195, 1.8633540372670794
0.9296482412060301, 2.049689440993788
0.9798994974874371, 2.298136645962728
1.0552763819095476, 2.5465838509316754
0.42713567839195976, 1.4285714285714235
0.4773869346733668, 1.2422360248447184
0.5527638190954773, 1.1180124223602448
0.6532663316582914, 0.9937888198757747
0.728643216080402, 0.9316770186335397
0.8542713567839195, 0.8695652173913047
1.0050251256281406, 0.8695652173913047
1.1306532663316582, 0.8695652173913047
1.2562814070351758, 0.683229813664596
1.1557788944723617, 0.4968944099378838
1.0301507537688441, 0.4347826086956488
0.9045226130653266, 0.4347826086956488
0.8291457286432156, 0.4347826086956488
0.6783919597989949, 0.4968944099378838
0.5276381909547736, 0.5590062111801188
0.4773869346733668, 0.6211180124223574
0.37688442211055273, 0.683229813664596
0.25125628140703515, 0.8695652173913047
0.1758793969849246, 1.0559006211180098
0.1507537688442211, 1.3043478260869534
2.0603015075376883, 0.9937888198757747
2.1105527638190953, 0.8695652173913047
2.185929648241206, 1.2422360248447184
2.236180904522613, 1.6149068322981357
2.28643216080402, 1.8633540372670794
2.3618090452261304, 2.111801242236023
2.4120603015075375, 2.4223602484472018
2.7135678391959797, 2.484472049689437
2.9396984924623117, 2.608695652173914
3.165829145728643, 2.670807453416149
3.040201005025125, 2.857142857142854
3.165829145728643, 2.9813664596273277
3.090452261306532, 3.167701863354033
3.165829145728643, 3.354037267080745
2.7135678391959797, 3.2298136645962714
2.5628140703517586, 3.1055900621117978
2.512562814070351, 2.857142857142854
2.7135678391959797, 2.857142857142854
2.6130653266331656, 3.41614906832298
2.7386934673366827, 3.602484472049685
2.6381909547738696, 3.6645962732919237
3.14070351758794, 2.4223602484472018
2.889447236180904, 2.236024844720493
2.6884422110552757, 2.173913043478258
2.6633165829145726, 1.9254658385093144
2.8140703517587937, 1.9254658385093144
3.090452261306532, 1.8012422360248443
3.090452261306532, 2.111801242236023
3.442211055276381, 1.9254658385093144
3.567839195979899, 2.111801242236023
3.693467336683417, 2.173913043478258
3.7688442211055273, 2.049689440993788
3.7939698492462304, 1.7391304347826093
3.6683417085427132, 1.4285714285714235
3.567839195979899, 1.1801242236024834
3.492462311557788, 0.9937888198757747
3.542713567839196, 0.8695652173913047
3.6432160804020093, 0.8695652173913047
3.8190954773869343, 0.9316770186335397
3.9195979899497484, 1.1180124223602448
4.0954773869346734, 1.0559006211180098
4.195979899497487, 0.8695652173913047
4.296482412060302, 0.9316770186335397
4.422110552763818, 1.1801242236024834
4.623115577889447, 1.0559006211180098
4.623115577889447, 1.4285714285714235
4.698492462311557, 1.4285714285714235
4.522613065326633, 1.4285714285714235
4.57286432160804, 1.6770186335403707
4.673366834170854, 1.8633540372670794
4.648241206030151, 1.9875776397515494
4.824120603015075, 1.8633540372670794
4.798994974874371, 1.7391304347826093
4.899497487437185, 1.9875776397515494
5.050251256281407, 1.9254658385093144
5.025125628140703, 1.5527950310558971
5.251256281407035, 1.3664596273291885
5.326633165829145, 1.490683229813662
5.402010050251256, 1.6770186335403707
5.552763819095477, 1.490683229813662
5.502512562814069, 1.1180124223602448
5.175879396984923, 1.1801242236024834
5.025125628140703, 1.2422360248447184
5.025125628140703, 0.9937888198757747
5.603015075376884, 0.745341614906831
5.7788944723618085, 0.745341614906831
5.92964824120603, 0.8695652173913047
6.080402010050251, 1.0559006211180098
6.281407035175879, 0.9316770186335397
6.381909547738693, 1.1180124223602448
6.281407035175879, 1.3043478260869534
6.180904522613065, 1.3664596273291885
6.231155778894472, 1.6770186335403707
6.331658291457286, 1.7391304347826093
6.281407035175879, 1.9875776397515494
6.4321608040201, 2.236024844720493
6.35678391959799, 2.484472049689437
6.50753768844221, 2.608695652173914
6.381909547738693, 2.795031055900619
6.608040201005026, 3.0434782608695627
6.457286432160803, 3.167701863354033
6.50753768844221, 3.41614906832298
6.683417085427135, 3.41614906832298
6.758793969849246, 3.7267080745341588
6.633165829145729, 3.7888198757763973
6.834170854271355, 3.9130434782608674
6.984924623115577, 3.9130434782608674
7.110552763819094, 3.9130434782608674
7.2361809045226115, 3.9130434782608674
7.3869346733668335, 3.9130434782608674
7.487437185929648, 4.099378881987576
7.587939698492462, 4.285714285714285
7.839195979899498, 4.409937888198755
7.864321608040201, 4.161490683229811
7.914572864321607, 3.8509316770186324
7.989949748743718, 3.602484472049685
7.688442211055274, 3.602484472049685
7.638190954773868, 3.354037267080745
7.763819095477387, 3.354037267080745
7.587939698492462, 3.1055900621117978
7.688442211055274, 3.0434782608695627
7.537688442211054, 2.795031055900619
7.638190954773868, 2.670807453416149
7.4623115577889445, 2.608695652173914
7.437185929648241, 2.3602484472049667
7.537688442211054, 2.298136645962728
7.688442211055274, 1.9875776397515494
7.613065326633165, 1.9254658385093144
7.587939698492462, 1.7391304347826093
7.7135678391959805, 1.6770186335403707
7.587939698492462, 1.3664596273291885
7.638190954773868, 1.2422360248447184
7.7135678391959805, 1.1801242236024834
7.814070351758793, 1.1180124223602448
7.964824120603013, 0.9937888198757747
8.065326633165828, 1.1180124223602448
8.241206030150753, 1.1801242236024834
8.090452261306531, 1.4285714285714235
8.115577889447238, 1.8012422360248443
8.165829145728644, 2.173913043478258
8.14070351758794, 2.5465838509316754
8.115577889447238, 2.9813664596273277
8.065326633165828, 3.2919254658385064
9.422110552763819, 3.41614906832298
9.447236180904522, 3.7267080745341588
9.396984924623116, 3.9751552795031024
9.321608040201003, 4.409937888198755
9.246231155778894, 4.658385093167702
9.195979899497488, 4.844720496894407
9.145728643216078, 5.093167701863354
9.070351758793969, 5.279503105590059
9.045226130653266, 5.527950310559007
8.944723618090453, 5.714285714285712
8.86934673366834, 5.838509316770185
8.819095477386934, 6.086956521739129
8.718592964824118, 6.335403726708073
8.668341708542712, 6.645962732919253
8.693467336683415, 6.956521739130434
8.718592964824118, 7.267080745341612
8.693467336683415, 7.577639751552795
8.693467336683415, 7.888198757763975
8.693467336683415, 8.136645962732917
8.668341708542712, 8.4472049689441
8.64321608040201, 8.695652173913041
8.417085427135678, 8.695652173913041
8.492462311557787, 8.881987577639752
8.592964824120603, 9.068322981366459
8.316582914572862, 8.4472049689441
8.190954773869347, 8.4472049689441
8.040201005025125, 8.4472049689441
7.889447236180904, 8.57142857142857
7.814070351758793, 8.75776397515528
7.688442211055274, 8.695652173913041
7.663316582914571, 8.385093167701863
7.663316582914571, 7.95031055900621
7.663316582914571, 7.515527950310558
7.688442211055274, 7.142857142857141
7.688442211055274, 7.0186335403726705
7.738693467336684, 6.645962732919253
7.78894472361809, 6.459627329192546
7.487437185929648, 6.397515527950308
7.3869346733668335, 6.583850931677018
7.3115577889447225, 6.83229813664596
7.261306532663315, 7.142857142857141
7.160804020100502, 7.267080745341612
6.984924623115577, 7.267080745341612
6.884422110552763, 7.329192546583849
6.733668341708543, 7.453416149068323
6.758793969849246, 6.956521739130434
6.708542713567838, 6.770186335403725
6.633165829145729, 6.521739130434781
6.608040201005026, 6.211180124223603
6.633165829145729, 5.838509316770185
6.708542713567838, 5.527950310559007
6.758793969849246, 5.217391304347824
6.658291457286432, 5.155279503105589
6.633165829145729, 4.844720496894407
6.633165829145729, 4.409937888198755
6.658291457286432, 4.099378881987576
6.030150753768844, 3.7267080745341588
5.879396984924623, 3.7267080745341588
5.7537688442211055, 3.478260869565215
5.6783919597989945, 3.2298136645962714
5.57788944723618, 2.9192546583850927
5.477386934673366, 2.608695652173914
5.427135678391959, 2.236024844720493
5.427135678391959, 1.9875776397515494
5.6783919597989945, 1.8633540372670794
5.829145728643216, 2.111801242236023
5.904522613065326, 2.3602484472049667
5.979899497487437, 2.484472049689437
6.030150753768844, 2.795031055900619
6.055276381909547, 3.1055900621117978
6.105527638190954, 3.478260869565215
5, 3.478260869565215
4.899497487437185, 3.478260869565215
4.824120603015075, 3.167701863354033
4.773869346733668, 2.9813664596273277
4.723618090452261, 2.795031055900619
4.899497487437185, 2.670807453416149
4.798994974874371, 2.4223602484472018
4.698492462311557, 2.484472049689437
4.723618090452261, 2.298136645962728
4.673366834170854, 2.236024844720493
4.472361809045226, 2.173913043478258
4.422110552763818, 2.111801242236023
4.321608040201005, 2.236024844720493
4.221105527638191, 2.298136645962728
4.221105527638191, 2.4223602484472018
4.0201005025125625, 2.484472049689437
4.0201005025125625, 2.236024844720493
4.14572864321608, 2.111801242236023
4.1206030150753765, 1.8633540372670794
4.271356783919598, 1.8633540372670794
4.221105527638191, 1.7391304347826093
4.0954773869346734, 1.490683229813662
4.0452261306532655, 1.3043478260869534
3.391959798994974, 1.6149068322981357
3.090452261306532, 1.490683229813662
3.090452261306532, 1.1801242236024834
3.29145728643216, 1.2422360248447184
3.21608040201005, 0.9937888198757747
3.115577889447235, 0.8695652173913047
2.6633165829145726, 1.3043478260869534
2.6633165829145726, 1.6149068322981357
2.7889447236180906, 1.6149068322981357
2.185929648241206, 0.4968944099378838
2.2613065326633164, 0.37267080745341374
2.386934673366834, 0.1863354037267051
2.512562814070351, 0
2.6381909547738696, -0.12422360248447362
2.7386934673366827, -0.24844720496894368
2.8643216080402008, -0.3105590062111858
3.015075376884422, -0.4347826086956559
3.21608040201005, -0.4968944099378909
3.341708542713568, -0.6211180124223645
3.492462311557788, -0.6211180124223645
3.693467336683417, -0.7453416149068346
3.8693467336683414, -0.7453416149068346
3.9195979899497484, -0.8695652173913082
4.0703517587939695, -0.8695652173913082
4.221105527638191, -0.8074534161490696
4.346733668341708, -0.8074534161490696
4.472361809045226, -0.8695652173913082
4.597989949748743, -0.9316770186335432
4.723618090452261, -0.9316770186335432
4.899497487437185, -0.9316770186335432
5.07537688442211, -0.9937888198757783
5.201005025125628, -0.9937888198757783
5.376884422110552, -0.9937888198757783
5.552763819095477, -0.9937888198757783
5.7035175879396975, -0.9937888198757783
5.854271356783919, -0.9937888198757783
6.055276381909547, -0.9316770186335432
6.231155778894472, -0.8695652173913082
6.35678391959799, -0.9316770186335432
6.482412060301506, -0.9316770186335432
6.608040201005026, -0.8695652173913082
6.683417085427135, -0.8695652173913082
6.809045226130652, -0.8074534161490696
6.884422110552763, -0.7453416149068346
7.035175879396985, -0.6832298136645996
7.160804020100502, -0.6211180124223645
7.261306532663315, -0.559006211180126
7.412060301507537, -0.4968944099378909
7.537688442211054, -0.4347826086956559
7.638190954773868, -0.37267080745342085
7.763819095477387, -0.18633540372670865
7.839195979899498, 0.06211180124223503
7.93969849246231, 0.37267080745341374
8.015075376884422, 0.6211180124223574
8.065326633165828, 0.8074534161490661
8.21608040201005, 0.8074534161490661
8.341708542713565, 0.745341614906831
8.442211055276381, 0.745341614906831
8.542713567839197, 0.8074534161490661
8.768844221105525, 0.8695652173913047
8.743718592964822, 0.6211180124223574
8.894472361809044, 0.6211180124223574
9.020100502512562, 0.683229813664596
9.120603015075375, 0.745341614906831
9.271356783919597, 0.8074534161490661
9.396984924623116, 0.8695652173913047
9.472361809045225, 0.8695652173913047
9.597989949748744, 0.8695652173913047
9.698492462311556, 0.8695652173913047
9.773869346733669, 0.8695652173913047
9.723618090452259, 0.683229813664596
9.798994974874372, 0.5590062111801188
9.924623115577887, 0.5590062111801188
10.07537688442211, 0.5590062111801188
10.201005025125628, 0.6211180124223574
10.326633165829147, 0.683229813664596
10.402010050251256, 0.745341614906831
10.502512562814069, 0.8695652173913047
10.552763819095475, 1.0559006211180098
10.502512562814069, 1.3043478260869534
10.402010050251256, 1.490683229813662
10.276381909547737, 1.490683229813662
10.150753768844218, 1.490683229813662
10.050251256281406, 1.490683229813662
9.949748743718594, 1.490683229813662
9.824120603015075, 1.490683229813662
9.723618090452259, 1.5527950310558971
9.597989949748744, 1.6149068322981357
9.522613065326631, 1.8633540372670794
9.522613065326631, 2.173913043478258
9.522613065326631, 2.4223602484472018
9.472361809045225, 2.732919254658384
9.472361809045225, 3.1055900621117978
8.718592964824118, 1.6149068322981357
8.768844221105525, 1.5527950310558971
8.668341708542712, 1.4285714285714235
8.768844221105525, 1.1801242236024834
8.592964824120603, 1.1180124223602448
7.562814070351759, 0.9316770186335397
7.437185929648241, 0.745341614906831
7.3115577889447225, 0.8695652173913047
7.160804020100502, 1.1801242236024834
7.2361809045226115, 1.3043478260869534
7.336683417085427, 1.490683229813662
7.261306532663315, 1.6149068322981357
7.412060301507537, 1.9254658385093144
7.36180904522613, 1.9875776397515494
6.959798994974874, 1.8633540372670794
6.633165829145729, 1.9254658385093144
6.608040201005026, 1.7391304347826093
6.683417085427135, 1.6149068322981357
6.859296482412058, 1.490683229813662
6.959798994974874, 1.4285714285714235
6.758793969849246, 1.1801242236024834
6.633165829145729, 1.3043478260869534
6.50753768844221, 1.3664596273291885
6.633165829145729, 0.9937888198757747
6.909547738693466, 0.9937888198757747
7.010050251256282, 1.0559006211180098
4.974874371859296, 2.9813664596273277
4.396984924623115, 3.2298136645962714
4.346733668341708, 3.1055900621117978
4.1708542713567835, 3.0434782608695627
4.1206030150753765, 2.795031055900619
4.296482412060302, 2.795031055900619
4.2462311557788945, 3.2919254658385064
7.537688442211054, 4.596273291925463
7.537688442211054, 4.844720496894407
7.78894472361809, 4.782608695652172
7.78894472361809, 5.155279503105589
7.487437185929648, 5.155279503105589
7.412060301507537, 5.403726708074533
7.336683417085427, 5.590062111801242
7.3869346733668335, 5.714285714285712
7.4623115577889445, 5.962732919254659
7.78894472361809, 5.838509316770185
7.78894472361809, 6.149068322981364
7.78894472361809, 5.527950310559007
7.2864321608040195, 7.577639751552795
7.7135678391959805, 9.006211180124222
1.8341708542713566, 9.565217391304346
1.708542713567839, 9.565217391304346
1.758793969849246, 9.68944099378882
1.0552763819095476, 9.254658385093167
0.9547738693467336, 9.316770186335404
1.1557788944723617, 9.068322981366459
0.9296482412060301, 8.944099378881987
0.9798994974874371, 8.75776397515528
1.0050251256281406, 8.509316770186334
1.0804020100502512, 8.260869565217389
1.1055276381909547, 7.95031055900621
1.1306532663316582, 7.63975155279503
1.1055276381909547, 7.329192546583849
1.1055276381909547, 7.0186335403726705
1.0552763819095476, 6.770186335403725
1.0050251256281406, 6.521739130434781
0.9798994974874371, 6.335403726708073
0.879396984924623, 6.024844720496894
0.8040201005025125, 5.714285714285712
0.728643216080402, 5.465838509316768
0.6783919597989949, 5.217391304347824
0.6030150753768844, 4.968944099378881
0.5527638190954773, 4.658385093167702
0.5025125628140703, 4.409937888198755
0.42713567839195976, 4.099378881987576

"""  # NOTE: Replace '...' with the rest of your full raw_data

# === 2. Parse data ===
points = np.array([[float(x) for x in line.split(',')] for line in raw_data.strip().split('\n')])

# === 2.1 Reorder points to form a smooth path ===
def reorder_points(points):
    ordered = [points[0]]
    remaining = points[1:].tolist()
    while remaining:
        last = ordered[-1]
        dists = cdist([last], remaining)
        next_index = np.argmin(dists)
        ordered.append(remaining.pop(next_index))
    return np.array(ordered)

points = reorder_points(points)

# === 2.2 Smoothly close the loop ===
fade_len = int(0.05 * len(points))  # Last 5% of points
for i in range(1, fade_len + 1):
    alpha = i / fade_len
    points[-i] = (1 - alpha) * points[-i] + alpha * points[0]
points = np.vstack([points, points[0]])  # Close loop

# === 2.3 Arc-length parameterization ===
x_vals, y_vals = points[:, 0], points[:, 1]
N = len(x_vals)
distances = np.sqrt(np.diff(x_vals)**2 + np.diff(y_vals)**2)
t_uniform = np.concatenate([[0], np.cumsum(distances)])
t_uniform /= t_uniform[-1]

# === 3. Fourier coefficient generator ===
def get_fourier_coeffs(f, num_terms=50):
    f_fft = np.fft.fft(f) / N
    a0 = f_fft[0].real
    an = 2 * f_fft[1:num_terms + 1].real
    bn = -2 * f_fft[1:num_terms + 1].imag
    return a0, an, bn

# === 4. Reconstruct function from coefficients ===
def reconstruct_fourier(a0, an, bn, t):
    f = np.full_like(t, a0)
    for n in range(1, len(an) + 1):
        f += an[n - 1] * np.cos(2 * np.pi * n * t) + bn[n - 1] * np.sin(2 * np.pi * n * t)
    return f

# === 5. Compute Fourier coefficients ===
num_terms = 50
x0, ax, bx = get_fourier_coeffs(x_vals, num_terms)
y0, ay, by = get_fourier_coeffs(y_vals, num_terms)

# === 6. Plot the reconstructed curve ===
t_plot = np.linspace(0, 1, 1000)
x_recon = reconstruct_fourier(x0, ax, bx, t_plot)
y_recon = reconstruct_fourier(y0, ay, by, t_plot)

plt.figure(figsize=(8, 8))
plt.plot(x_vals, y_vals, 'o', markersize=2, alpha=0.5, label='Original Points')
plt.plot(x_recon, y_recon, '-', linewidth=2, color='orange', label='Fourier Approximation')
plt.title('Improved Fourier Approximation (Smooth + Periodic)')
plt.axis('equal')
plt.grid(True)
plt.legend()
plt.show()
